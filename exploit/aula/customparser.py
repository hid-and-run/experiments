from pcapng import FileScanner
from pcapng.blocks import EnhancedPacket
import binascii

with open('aula.pcapng', 'rb') as fp:
    scanner = FileScanner(fp)
    for i, block in enumerate(scanner):
        if isinstance(block, EnhancedPacket):
            data = bytearray(block.packet_data)
            if len(data) > 35:
                direction = "IN " if data[21] else "OUT"
                if direction != "OUT":
                    continue
                bRequest = "SET" if data[27 + 2] == 9 else "GET"
                reportId = data[27 + 3]
                reportType = "Feature" if data[27 + 4] == 3 else "I/O"
                if reportType != "Feature":
                    continue
                # print(f"await device.sendFeatureReport({reportId}, new Uint8Array([ {', '.join([f'0x{val}' for val in data[37:].hex(' ', 1).split()])} ])); await sleep(100);")
                print(f"{str(reportId).rjust(2)} - {binascii.hexlify(data[37:], ' ')} / {len(data[37:])}")