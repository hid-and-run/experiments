# General

## Packet
* 7 byte per packet
* first byte always(?) 0x18
* last byte 0 or 7
* bytes
    * `18`: fixed
    * command, observed `00`, `03`, `09` (3 = write, 0/9 are for blocks(?))
    * index
    * offset
    * page: 0 contains button assignments, 4 contains macros ~~`04` = macro, `00` = write raw data?, others?~~
    * data
    * `00` or `07` (why?)

## Operation
* The mouse has 5 "pages" with each 256 bytes. 
* Command `03` writes a byte to a page. 
* The address is `index + offset` (makes no sense to waste 2 bytes for an 8-bit address, but what do I know...)
* It seems that every 8 bytes the device expects control commands (`00` and `09`) to "finalize" a block

# Data Structures

## Buttons
* page 0 contains the button assignments for all profiles
* profile structs start at the following indices: 0x8, 0x44, 0x50, and 0x60 (4 profiles are supported)
* each profile has 9 bytes -> support for 9 buttons
* buttons are encoded in the following order (order from the GUI): 1, 3, 2, 5, 4, 7, not_existing, 6, 8
* each button is encoded as 1 byte, values are (incomplete list):
    * 0x0 -> N/A
    * 0x21 -> Left click
    * 0x22 -> Middle click
    * 0x23 -> Right click
    * 0x24 -> Backward
    * 0x25 -> Forward
    * 0x35 -> LED Loop
    * 0x26 -> DPI Loop
    * 0x28 -> Double Click
    * 0x2f -> Mute
    * 0x2d -> [MACRO]

## Macro Assignment
* there is an additional macro-assignment structure per button that maps a button to a macro if it has the value 0x2d
* each structure has 10 bytes that encode the following information (in this order):
    * valid (1 = valid, 0 = invalid)
    * length in events (event = delay + key)
    * 255
    * unknown
    * unknown 0
    * start index as byte offset on page 4
    * page? always 4
    * unknown 0
    * unknown
    * unknown 0
* each structure exists for every button, i.e., 9 times -> 90 bytes per button for macro assignments
* this is repeated for every profile
* the structures for the 4 profiles start at the following offsets 0xa0 (page 0), 0x2c (page 1), 0xb8 (page 1), 0x44 (page 2)
    
## Macro format

* ~~based on save file format possibly 48 bytes per macro~~
* blocks of 8 packets + 2 footer(?) packets
    * 8x: `18 03 <1 byte index, 0-7> <1 byte offset> 04 <1 byte data> 07`
    * ~~The offset is always a multiple of 8, starting at 0~~
    * Keys and modifiers are encoded in default HID encodings
    * ~~Not clear how up/down events and modifiers are encoded~~
    * Each key (event) has its own packet
    * Footer: `18 09 00 <1 byte offset> 04 00 07` and `18 00 00 <1 byte offset> 04 00 00`. 
    * `04` = maybe "normal key"
* always 1 packet delay+pressed and 1 packet key -> up to 4 keys per block
    * delay = (byte & 0x7f) * 2 in ms
    * pressed = byte & 0x80 (if 1, then pressed, otherwise released)
    * key = HID encoding
* exception: mouse movements
    * delay = (byte & 0x7f) * 2 in ms
    * pressed = byte & 0x80 (if 1, then pressed, otherwise released)
    * key = 0xf6
    * after the key: 16-bit signed short X movement, 16-bit signed short Y movement
    

## LEDs
* 0x1c (page 0) stores LED state: 
    * 0x94: default
    * 0x97: off
    * 0xa4: LED on
        * brightness is at 0x3f (page 0): 0x60 = 1 (lowest), 0x50 = 2, 0x40 = 3, 0x30 = 4, 0x20 = 5, 0x10 = 6, 0x00 = 7 (full)
    * 0xe1: Neon
        * speed is at 0x3f (page 0): 0x00 = 1 (slowest), 0x50 = 2, 0x40 = 3, 0x30 = 4, 0x20 = 5, 0x10 = 6, 0x00 = 7 (fastest)
    * 0x82: DPI Breathing
        * speed is at 0x3f (page 0): 0x00 = 1 (slowest), 0x50 = 2, 0x40 = 3, 0x30 = 4, 0x20 = 5, 0x10 = 6, 0x00 = 7 (fastest)
    * 0x93: Cycle Breathing
        * active colors are as bitmask in 0x1d (page 0)
        * speed is at 0x3f (page 0): 0x00 = 1 (slowest), 0x50 = 2, 0x40 = 3, 0x30 = 4, 0x20 = 5, 0x10 = 6, 0x00 = 7 (fastest)
